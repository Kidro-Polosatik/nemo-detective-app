<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–µ—á–Ω—ã–π –î–µ—Ç–µ–∫—Ç–∏–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/secret-message-style.css">
</head>
<body>
    <div class="app-container" id="app-container">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ—Ç–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–µ–ª–∞...</div>
    </div>

    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö -->
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –î–û –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        window.episodes = window.episodes || {};
        window.appState = window.appState || {
            currentView: 'menu',
            currentEpisodeId: null,
            userData: {
                score: 0,
                currentEpisode: 1,
                completedEpisodes: [],
                userId: null
            }
        };
        
        // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
        window.handleScriptError = function(error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞:', error);
            const container = document.getElementById('app-container');
            if (container) {
                container.innerHTML = `
                    <div class="error-container" style="text-align: center; padding: 40px 20px;">
                        <h2 style="color: #ff6b6b; margin-bottom: 20px;">üïµÔ∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                        <p style="margin-bottom: 20px; font-size: 16px;">${error}</p>
                        <button onclick="location.reload()" style="
                            background: #ffd700; 
                            color: #1a1a2e; 
                            border: none; 
                            padding: 12px 24px; 
                            border-radius: 8px; 
                            cursor: pointer;
                            font-weight: bold;
                            margin: 5px;
                        ">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
                        <button onclick="window.Menu?.show() || location.reload()" style="
                            background: rgba(255, 255, 255, 0.1); 
                            color: #ffd700; 
                            border: 1px solid #ffd700; 
                            padding: 12px 24px; 
                            border-radius: 8px; 
                            cursor: pointer;
                            font-weight: bold;
                            margin: 5px;
                        ">‚Üê –í –º–µ–Ω—é</button>
                    </div>
                `;
            }
        };

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–ø–æ–π–º–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(e) {
            console.error('üí• –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', e.error);
        });
    </script>

    <!-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    
    <!-- 1. –ë–∞–∑–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã -->
    <script src="js/phrases.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å phrases.js')"></script>
    <script src="js/answers.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å answers.js')"></script>

    <!-- 2. –≠–ø–∏–∑–æ–¥—ã -->
    <script src="js/episodes/chapter1/episode1.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å episode1.js')"></script>
    <script src="js/episodes/chapter1/episode2.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å episode2.js')"></script>
    <script src="js/episodes/chapter1/episode3.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å episode3.js')"></script>
    <script src="js/episodes/chapter1/episode4.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å episode4.js')"></script>
    <script src="js/episodes/chapter1/episode5.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å episode5.js')"></script>
    <script src="js/episodes/chapter1/episode6.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å episode6.js')"></script>
    <script src="js/episodes/chapter1/episode7.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å episode7.js')"></script>

    <!-- 3. –°–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
    <script src="js/episodes/secret-message.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å secret-message.js')"></script>

    <!-- 4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–≤ –ø–æ—Ä—è–¥–∫–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏) -->
    <script src="js/components/rating.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å rating.js')"></script>
    <script src="js/components/episode-view.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å episode-view.js')"></script>
    <script src="js/components/menu.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å menu.js')"></script>

    <!-- 5. –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <script src="js/app.js" onerror="handleScriptError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å app.js')"></script>

    <!-- –†–µ–∑–µ—Ä–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
    <script>
        // –†–µ–∑–µ—Ä–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ –µ—Å–ª–∏ DOMContentLoaded –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª
        setTimeout(() => {
            if (!window.app && document.readyState === 'complete') {
                console.log('‚ö° –†–µ–∑–µ—Ä–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
                if (typeof NemoDetectiveApp !== 'undefined') {
                    window.app = new NemoDetectiveApp();
                } else {
                    console.error('‚ùå NemoDetectiveApp –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    handleScriptError('–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å');
                }
            }
        }, 3000);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        window.addEventListener('load', function() {
            console.log('üéØ –í—Å–µ —Ä–µ—Å—É—Ä—Å—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
            const requiredComponents = ['Menu', 'EpisodeView', 'Rating'];
            const missing = requiredComponents.filter(comp => typeof window[comp] === 'undefined');
            
            if (missing.length > 0) {
                console.warn('‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:', missing);
            }
        });
    </script>
</body>
</html>